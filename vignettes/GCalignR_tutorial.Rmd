---
title: "Aligning Peaks: A Tutorial"
author: "Meinolf Ottensmann, Martin A. Stoffel, Joseph Hoffman"
output: rmarkdown::html_vignette
bibliography: bibliography.bib
vignette: >
  %\VignetteIndexEntry{Aligning Peaks: A Tutorial}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, echo = FALSE}
library(knitr)
knitr::opts_chunk$set(collapse = TRUE, comment = "#>",cache = FALSE,
    fig.width = 7, fig.height = 7) # warning = FALSE
```

## Summary
During the alignment procedure of peak data derived from gas-chromatograpy with the GCalignR package the user needs to make certain decisions that might alter the final outcome. These include the appropriate specification of three paramters which can have an important influence on the alignment of retention times. Therefore, GCalignR incorporates diagnostic plots that are intended to assist the user in assessing the goodness of an alignment and revising alignment parameters in GCalignR as well as peak calling parameters in preceding tools if necessary. This document provides a comprehensive tutorial how to use these functionalities for the choosing and revising alignment parameters based on a dataset that is comprised of chemical signatures of the bumblebee species *Bombus flavifrons* [@Dellicour.2013]. For a quick overview we refer to \href{../doc/GCalignR_step_by_step.html}{GCalignR Step by Step}.

## Prerequisites
Some packages need to be available for the excecution of the following commands.
```{r,results='hide'}
library(GCalignR)
library(stringr)
library(readr)
```

## Data format
The common input format of data to align with **GCalignR** is a tab-delimited text file that is similar to typical export files of proprietary peak calling software such as *Xcalibur* (Thermofischer Scientific).

```{r}
library(GCalignR)
# Get the path to the dataset
fpath <- system.file("extdata", "bfla.txt", package = "GCalignR")
fpath 
# The first row contains all sample names
read_lines(fpath, n_max = 1) %>% str_split(pattern = "\t") %>% unlist()
# The second row contains variable names
read_lines(fpath, n_max = 1, skip = 1) %>% str_split(pattern = "\t") %>% unlist()
#
```

## A first alignment
```{r}
# Submit the path to the text file and define concentration and retention time variab
align_1 <- align_chromatograms(data = fpath,conc_col_name = "Area",rt_col_name = "RT") 
```
```{r}
plot(align_1)
```

## Using Heatmaps
Heatmaps can be used to visualise a large dataset at a glance but allow to explore the data in detail as well. 

```{r, cache = FALSE}
GCalignR::gc_heatmap(object = align_1, type = "discrete",label = T)
``` 

## References
